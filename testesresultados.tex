\chapter{Testes e Análise de Resultados} \label{chap:testes}

Este capitulo apresenta o ambiente de testes desenvolvido para validar o sistema, os testes efetuados e os resultados obtidos.
A seção \ref{sec:testes_ambiente} apresenta um ambiente de testes, que possibilita a captura de imagens de forma automatizada e os objetos utilizados para validação do sistema. Em seguida, na seção \ref{sec:testes_testes}, são apresentados os testes aos quais o sistema foi submetido e os respectivos resultados obtidos. Ao final, na seção \ref{sec:testes_consideracoes}, são apresentadas algumas considerações.


\section{Ambiente de testes} \label{sec:testes_ambiente}

Inicialmente para validar o sistema proposto é necessário a definição dos objetos reconhecidos. Com o objetivo de possibilitar a validação do sistema porém sem comprometer a aplicação real do projeto utilizam-se os objetos dispostos na figura \ref{fig:testes_objetos}. Os objetos são caracteres alfanuméricos, formas geométricas básicas e algumas formas aleatórias. Os objetos foram selecionados com o objetivo de testar a robustez do sistema. Portanto foram utilizadas formas semelhantes, como o carácter 'S' e o número '5'. Além disso existem algumas peculiaridades em alguns caracteres. O carácter 'S', por exemplo, possui a parte superior ligeiramente menor que a inferior, avaliando a robustez e precisão da estimativa de ângulo.

TODO: inserir imagem.
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.9\textwidth]{./figs/testes_objetos.jpg}
%	\caption{Objetos de teste.}
%	\fonte{Autoria própria}
%	\label{fig:testes_objetos}
%\end{figure}

Para facilitar a execução de testes o ambiente deve permitir a captura de imagens dos objetos em diversas orientações angulares, e possibilitar também o reposicionamento automático dos objetos para outros ângulos. Um ambiente que atende a esses requisitos foi montado utilizando o kit de montagem de robôs da LEGO chamado \emph{Mindstorms} \cite{MINDSTORMS}. O ambiente foi montado conforme mostra a figura \ref{fig:testes_ambiente}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{./figs/ambiente_teste.jpg}
	\caption{Montagem do ambiente de testes.}
	\fonte{Autoria própria}
	\label{fig:testes_ambiente}
\end{figure}

O sistema desenvolvido em MATLAB comunica-se com a unidade programável do \emph{Mindstorms}, também chamada de \emph{brick}, através de uma conexão \emph{bluetooth}. A comunicação é unidirecional do ponto de vista do MATLAB. O \emph{brick} comunica-se com um servo-motor que fornece realimentação por meio de um \emph{encoder}. Além da realimentação do \emph{encoder} foi adicionada uma malha de realimentação externa para fornecer um referencial absoluto ao sistema por meio de uma chave de fim de curso.

As funções implementadas dentro do \emph{brick} são as seguintes:

\begin{itemize}
\item Reset: Gira o objeto no sentido anti-horário até atingir o zero absoluto definido pelo acionamento da chave de fim de curso.
\item Step: Gira o objeto no sentido anti-horário até um ângulo especificado por meio de parâmetros. A posição do servo-motor é obtida pela realimentação do \emph{encoder}.
\end{itemize}

Para completar o ambiente de testes foi utilizado uma \emph{webcam} acessada pelo MATLAB para captura de imagens e foi montado um sistema de iluminação. O sistema de iluminação foi montado ao redor da câmera de maneira a não formar sombras visíveis a partir do ponto de vista da \emph{webcam}. A montagem completa pode ser vista nas imagens da figura \ref{fig:testes_ambiente_completo}.

\begin{figure}[H]
        \centering
	\begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{./figs/ambiente_completo_teste_camera.jpg}
	        \caption{Câmera com iluminação ao redor.}
        \end{subfigure}
       ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
        \begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{./figs/ambiente_completo_teste_objeto.jpg}
	        \caption{Objeto posicionado.}
        \end{subfigure}
       
	\begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{./figs/ambiente_completo_teste_mindstorms.jpg}
	        \caption{\emph{Mindstorms.}}
        \end{subfigure}
       ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
	\begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{./figs/ambiente_completo_teste_tudo.jpg}
	        \caption{Montagem completa.}
        \end{subfigure}

	\caption{Montagem do ambiente de testes.}
	\fonte{Autoria própria}
	\label{fig:testes_ambiente_completo}
\end{figure}

\section{Testes} \label{sec:testes_testes}

O sistema foi testado com duas configurações diferentes. A primeira configuração foi formada por todos os objetos mostrados na figura \ref{fig:testes_teste1_objetos}. Ou seja, oito caracteres alfa-numéricos. O segundo teste foi efetuado com ... TODO

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/testes_teste1_objetos.jpg}
	\caption{Objetos para o primeiro teste.}
	\fonte{Autoria própria}
	\label{fig:testes_teste1_objetos}
\end{figure}


\subsection{Primeiro teste: 8 objetos}

Inicialmente cada objeto foi posicionado no ambiente de testes e foram efetuadas $360$ capturas. Uma captura a cada $1^o$, tanto para o fundo, quanto para o objeto. As imagens foram salvas e a classe e ângulo de captura armazenados. Após capturar as imagens para todos os objetos os descritores foram calculados conforme exposto no capitulo \ref{chap:desenv}. Tanto a rede de classificação quanto as redes de estimativa de ângulo foram treinadas.
Na sequencia foram capturas 20 imagens em rotações aleatórias de cada objeto e as respectivas imagens de fundo. Novamente os dados foram armazenados. O sistema foi executado para as 160 imagens de teste capturadas e o resultado foi comparado com os valores esperados. A comparação entre valores de classe esperados e obtidos pode ser visto na matriz de confusão apresentada na figura \ref{fig:testes_teste1_matriz}. Para a estimativa do ângulo o resultado pode ser visto na figura \ref{fig:testes_teste1_erros}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/8-classes.png}
	\caption{Matriz de confusão para 8 objetos (formando 16 classes).}
	\fonte{Autoria própria}
	\label{fig:testes_teste1_matriz}
\end{figure}

\begin{figure}[H]
        \centering
	\begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-erro-medio.png}
	        \caption{Erro médio da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste1_medio}
        \end{subfigure}

        \begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-desvio.png}
	        \caption{Desvio padrão do erro da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste1_desvio}
        \end{subfigure}
       
	\begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-erro-maximo.png}
	        \caption{Erro máximo da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste1_maximo}
        \end{subfigure}

	\caption{Erros e desvios para cada objeto.}
	\fonte{Autoria própria}
	\label{fig:testes_teste1_erros}
\end{figure}


\subsection{Segundo teste: 16 objetos}

O mesmo procedimento executado para o primeiro teste foi executado para o segundo. A diferença foi apenas o número de objetos utilizados que aumentou para 16. Foram capturadas também 20 imagens em posições aleatórias para o teste de cada objeto.
A matriz de confusão é apresentada na figura \ref{fig:testes_teste2_matriz} e o resultado da estimativa de ângulo é apresentado na figura \ref{fig:testes_teste2_erros}.

TODO: trocar imagens

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/8-classes.png}
	\caption{Matriz de confusão para 16 objetos (formando 32 classes).}
	\fonte{Autoria própria}
	\label{fig:testes_teste2_matriz}
\end{figure}

\begin{figure}[H]
        \centering
	\begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-erro-medio.png}
	        \caption{Erro médio da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste2_medio}
        \end{subfigure}

        \begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-desvio.png}
	        \caption{Desvio padrão do erro da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste2_desvio}
        \end{subfigure}
       
	\begin{subfigure}[b]{0.6\textwidth}
                \includegraphics[width=\textwidth]{./figs/8-classes-erro-maximo.png}
	        \caption{Erro máximo da estimativa do ângulo para 8 objetos.}
		\label{fig:testes_teste2_maximo}
        \end{subfigure}

	\caption{Erros e desvios para cada objeto.}
	\fonte{Autoria própria}
	\label{fig:testes_teste2_erros}
\end{figure}


\section{Considerações} \label{sec:testes_consideracoes}

Nesse capítulo apresentou-se um ambiente de testes automatizado que possibilitou a validação do sistema apresentado no capitulo \ref{chap:desenv}. Utilizando o ambiente foram executados dois grupos de testes. O primeiro com 8 objetos e o segundo com 16 objetos. 

O sistema mostrou-se capaz de classificar todos os objetos corretamente com $100\%$ de acerto. Isso se deu devido à qualidade dos descritores calculados, que permitiram resumir as principais características de cada classe. Além disso a topologia da rede de classificação teve importante papel para a convergência no treinamento e para a qualidade de decisão. Inicialmente havia sido utilizada uma rede com apenas uma saída, onde cada classe estava associada a uma faixa de valores entre $0$ e $1$. O resultado dessa abordagem inicial está exposto na figura \ref{fig:testes_teste0_matriz}. Como se pode ver, a taxa de acerto foi de apenas $78\%$, o que é inaceitável para o problema pois se há um erro na classificação automaticamente a estimativa do angulo falhará também.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.45\textwidth]{./figs/6-hiddenlayers.png}
	\caption{Matriz de confusão para 8 objetos - rede com 1 saída.}
	\fonte{Autoria própria}
	\label{fig:testes_teste0_matriz}
\end{figure}

Na estimativa do ângulo obteve se a precisão de $\pm4.1^o$, o que representa $2.25\%$ do total de $360^o$ possíveis. O erro médio no entanto manteve-se em $1.3^o$, com desvio de $0.85^o$. O erro na estimativa do ângulo é bastante influenciada pelo sucesso na etapa de segmentação e normalização da imagem. É necessário portanto para obter bons resultados controlar ao máximo as condições externas de captura das imagens. Condições boas de iluminação por exemplo tendem a melhorar o resultado da etapa de segmentação. 

Os testes mostraram portanto que o sistema foi capaz de identificar os objetos corretamente e estimar a posição angular com precisão de $\pm4.1^o$.

